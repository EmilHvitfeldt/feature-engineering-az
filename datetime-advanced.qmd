# Advanced features {#sec-datetime-advanced}

```{r}
#| echo: false
#| message: false
library(tidyverse)
```


All the features we were able to extract were related to what day or time it was for an given observation. Or numbers on the form "how many since start of month" or "how many days since start of week". And while this information can be useful, there will often be times where we want to do slight modifications that can result in huge payoff.

Consider merchandise sale related data. The mere indication of a specific dates might become useful, but the sale amount is not likely to be affected just on the sale days, but on the surrounding days as well. Consider the American Black Friday. This day is predetermined to come every year at a easily recognized day, namely the last Friday of November. Considering its close time to Christmas other gift-giving holidays, it is a common day for thrifty people to start buying presents.

In the extraction sense we have a single indicator for the day of black friday

```{r}
tibble(
  day = as_date("2023-11-24") + c(-5:5),
  black_friday = c(rep(0, 5), 1, rep(0, 5))
) |>
  ggplot(aes(day, black_friday)) +
  geom_col() +
  theme_minimal()
```

But it would make sense that since we know the day of black friday, that the sales will see a drop on the previous days, we can incorporate that as well.

```{r}
tibble(
  day = as_date("2023-11-24") + c(-5:5),
  black_friday = c(-0.5 ^ (5:1), 1, rep(0, 5))
) |>
  ggplot(aes(day, black_friday)) +
  geom_col() +
  theme_minimal()
```

On the other hand, once the sale has started happening for the sales to pick up again. Since this is the last big sale before the Holidays, shoppers are free to buy their remaining presents as they don't have to fear of the item going on sale.

```{r}
tibble(
  day = as_date("2023-11-24") + c(-5:5),
  black_friday = c(-0.5 ^ (5:1), 1, 0.25 ^ (1:5/2))
) |>
  ggplot(aes(day, black_friday)) +
  geom_col() +
  theme_minimal()
```

The exact effects shown here are just approximate to our story at hand. But they provide a useful illustration. There are a lot of bandwidth to be given if we look at date times from a distance perspective. 

We can play around with "distance from" and "distance to", different numerical transformations we saw in @sec-numeric, signs and indicators we talked about in @sec-datetime-extraction to tailor our feature engineering to our problem.

talk about slopes before and after

talk about that we can do this periodically

talk about how we can do it irregularly (preplaned sales/holidays)

This is different than circular

## Pros and Cons

### Pros

### Cons

## R Examples

## Python Examples

